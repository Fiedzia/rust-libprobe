<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `probe` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, probe">

    <title>probe - Rust</title>

    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    <link rel="shortcut icon" href="http://www.rust-lang.org/favicon.ico">
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        <a href='../probe/index.html'><img src='http://www.rust-lang.org/logos/rust-logo-128x128-blk-v2.png' alt='logo' width='100'></a>
        <p class='location'></p><script>window.sidebarCurrent = {name: 'probe', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Crate <a class='mod' href=''>probe</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a id='src-0' class='srclink' href='../src/probe/src/lib.rs.html#11-148' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>This crate provides static instrumentation macros.</p>

<p>With the <code>probe!</code> macro, programmers can place static instrumentation
points in their code to mark events of interest.  These are compiled into
platform-specific implementations, e.g. SystemTap SDT on Linux.  Probes are
designed to have negligible overhead during normal operation, so they can
be present in all builds, and only activated using those external tools.</p>

<h1 id='example' class='section-header'><a href='#example'>Example</a></h1>
<p>This simple example instruments the beginning and end of program, as well
as every iteration through the loop with arguments for the counter and
intermediate total.</p>

<pre class='rust rust-example-rendered'>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>feature</span>(<span class='ident'>asm</span>)]</span>
<span class='attribute'>#[<span class='ident'>macro_use</span>]</span> <span class='attribute'>#[<span class='ident'>no_link</span>]</span>
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>probe</span>;
<span class='kw'>fn</span> <span class='ident'>main</span>() {
    <span class='macro'>probe</span><span class='macro'>!</span>(<span class='ident'>foo</span>, <span class='ident'>begin</span>);
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>total</span> <span class='op'>=</span> <span class='number'>0</span>;
    <span class='kw'>for</span> <span class='ident'>i</span> <span class='kw'>in</span> <span class='number'>0</span>..<span class='number'>100</span> {
        <span class='ident'>total</span> <span class='op'>+=</span> <span class='ident'>i</span>;
        <span class='macro'>probe</span><span class='macro'>!</span>(<span class='ident'>foo</span>, <span class='kw'>loop</span>, <span class='ident'>i</span>, <span class='ident'>total</span>);
    }
    <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>total</span>, <span class='number'>4950</span>);
    <span class='macro'>probe</span><span class='macro'>!</span>(<span class='ident'>foo</span>, <span class='ident'>end</span>);
}</pre>

<h2 id='using-probes-with-systemtap' class='section-header'><a href='#using-probes-with-systemtap'>Using probes with SystemTap</a></h2>
<p>For the program above, a SystemTap script could double-check the totals:</p>

<pre><code class="language-notrust">global check

probe process.provider(&quot;foo&quot;).mark(&quot;loop&quot;) {
    check += $arg1;
    if (check != $arg2)
        printf(&quot;foo total is out of sync! (%d != %d)\n&quot;, check, $arg2);
}

// .provider is optional
probe process.mark(&quot;begin&quot;), process.mark(&quot;end&quot;) {
    printf(&quot;%s:%s\n&quot;, $$provider, $$name);
}
</code></pre>

<p>Since this program behaves as expected, this script will not have any complaint.</p>

<pre><code class="language-notrust">$ stap --dyninst foo.stp -c ./foo
foo:begin
foo:end
</code></pre>

<h2 id='using-probes-with-gdb' class='section-header'><a href='#using-probes-with-gdb'>Using probes with GDB</a></h2>
<p>Starting in version 7.5, GDB can set breakpoints on probes and read arguments.</p>

<pre><code class="language-notrust">(gdb) info probes
Provider Name  Where              Semaphore Object
foo      begin 0x0000000000402e70           /tmp/foo
foo      end   0x000000000040315c           /tmp/foo
foo      loop  0x0000000000402f25           /tmp/foo
(gdb) break -probe foo:loop
Breakpoint 1 at 0x402f25
(gdb) condition 1 $_probe_arg1 &gt; 1000
(gdb) run
Starting program: /tmp/foo
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib64/libthread_db.so.1&quot;.

Breakpoint 1, 0x0000000000402f25 in main::hd67360886023c1c6faa::v0.0 ()
(gdb) print $_probe_arg0
$1 = 45
(gdb) print $_probe_arg1
$2 = 1035
</code></pre>
</div><h2 id='macros' class='section-header'><a href="#macros">Macros</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='macro' href='macro._sdt_asm!.html'
                                  title='probe::_sdt_asm!'>_sdt_asm!</a></td>
                           <td class='docblock short'>
                                
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='macro' href='macro.platform_probe!.html'
                                  title='probe::platform_probe!'>platform_probe!</a></td>
                           <td class='docblock short'>
                                
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='macro' href='macro.probe!.html'
                                  title='probe::probe!'>probe!</a></td>
                           <td class='docblock short'>
                                <p>Define a static probe point.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='macro' href='macro.sdt_asm!.html'
                                  title='probe::sdt_asm!'>sdt_asm!</a></td>
                           <td class='docblock short'>
                                
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "probe";
        window.playgroundUrl = "";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    
    <script defer src="../search-index.js"></script>
</body>
</html>