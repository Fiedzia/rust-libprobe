<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The probe library documentation.">

    <title>probe - Rust</title>

    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:400,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../main.css">

    <link rel="shortcut icon" href="http://www.rust-lang.org/favicon.ico">
</head>
<body>
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    <section class="sidebar">
        <a href='../probe/index.html'><img src='http://www.rust-lang.org/logos/rust-logo-128x128-blk-v2.png' alt='' width='100'></a>
        <p class='location'></p>
    </section>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press 'S' to search, '?' for more options..."
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'>Crate <a class='mod' href=''>probe</a><a class='stability Experimental' title=''>Experimental</a><a class='source' id='src-0' href='../src/probe/src/lib.rs.html#11-149'>[src]</a></h1>
<div class='docblock'><p>This crate provides static instrumentation macros.</p>

<p>With the <code>probe!</code> macro, programmers can place static instrumentation
points in their code to mark events of interest.  These are compiled into
platform-specific implementations, e.g. SystemTap SDT on Linux.  Probes are
designed to have negligible overhead during normal operation, so they can
be present in all builds, and only activated using those external tools.</p>

<h1 id="example" class='section-header'><a
                           href="#example">Example</a></h1>
<p>This simple example instruments the beginning and end of program, as well
as every iteration through the loop with arguments for the counter and
intermediate total.</p>
<pre class='rust '>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>feature</span>(<span class='ident'>phase</span>)]</span>
<span class='attribute'>#[<span class='ident'>phase</span>(<span class='ident'>plugin</span>)]</span>
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>probe</span>;
<span class='kw'>fn</span> <span class='ident'>main</span>() {
    <span class='macro'>probe</span><span class='macro'>!</span>(<span class='ident'>foo</span>, <span class='ident'>begin</span>);
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>total</span> <span class='op'>=</span> <span class='number'>0</span>;
    <span class='kw'>for</span> <span class='ident'>i</span> <span class='kw'>in</span> <span class='ident'>range</span>(<span class='number'>0u</span>, <span class='number'>100</span>) {
        <span class='ident'>total</span> <span class='op'>+=</span> <span class='ident'>i</span>;
        <span class='macro'>probe</span><span class='macro'>!</span>(<span class='ident'>foo</span>, <span class='kw'>loop</span>, <span class='ident'>i</span>, <span class='ident'>total</span>);
    }
    <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>total</span>, <span class='number'>4950</span>);
    <span class='macro'>probe</span><span class='macro'>!</span>(<span class='ident'>foo</span>, <span class='ident'>end</span>);
}
</pre>

<h2 id="using-probes-with-systemtap" class='section-header'><a
                           href="#using-probes-with-systemtap">Using probes with SystemTap</a></h2>
<p>For the program above, a SystemTap script could double-check the totals:</p>

<pre><code class="language-notrust">global check

probe process.provider(&quot;foo&quot;).mark(&quot;loop&quot;) {
    check += $arg1;
    if (check != $arg2)
        printf(&quot;foo total is out of sync! (%d != %d)\n&quot;, check, $arg2);
}

// .provider is optional
probe process.mark(&quot;begin&quot;), process.mark(&quot;end&quot;) {
    printf(&quot;%s:%s\n&quot;, $$provider, $$name);
}</code></pre>

<p>Since this program behaves as expected, this script will not have any complaint.</p>

<pre><code class="language-notrust">$ stap --dyninst foo.stp -c ./foo
foo:begin
foo:end</code></pre>

<h2 id="using-probes-with-gdb" class='section-header'><a
                           href="#using-probes-with-gdb">Using probes with GDB</a></h2>
<p>Starting in version 7.5, GDB can set breakpoints on probes and read arguments.</p>

<pre><code class="language-notrust">(gdb) info probes
Provider Name  Where              Semaphore Object
foo      begin 0x0000000000402e70           /tmp/foo
foo      end   0x000000000040315c           /tmp/foo
foo      loop  0x0000000000402f25           /tmp/foo
(gdb) break -probe foo:loop
Breakpoint 1 at 0x402f25
(gdb) condition 1 $_probe_arg1 &gt; 1000
(gdb) run
Starting program: /tmp/foo
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib64/libthread_db.so.1&quot;.

Breakpoint 1, 0x0000000000402f25 in main::hd67360886023c1c6faa::v0.0 ()
(gdb) print $_probe_arg0
$1 = 45
(gdb) print $_probe_arg1
$2 = 1035</code></pre>
</div><h2 id='macros' class='section-header'><a href="#macros">Macros</a></h2>
<table>
                    <tr>
                        <td><a class='macro' href='macro.probe!.html'
                               title='probe::probe!'>probe!</a></td>
                        <td class='docblock short'><p>Define a static probe point.</p>
</td>
                    </tr>
                </table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <div id="help" class="hidden">
        <div class="shortcuts">
            <h1>Keyboard shortcuts</h1>
            <dl>
                <dt>?</dt>
                <dd>Show this help dialog</dd>
                <dt>S</dt>
                <dd>Focus the search field</dd>
                <dt>&larrb;</dt>
                <dd>Move up in search results</dd>
                <dt>&rarrb;</dt>
                <dd>Move down in search results</dd>
                <dt>&#9166;</dt>
                <dd>Go to active search result</dd>
            </dl>
        </div>
        <div class="infos">
            <h1>Search tricks</h1>
            <p>
                Prefix searches with a type followed by a colon (e.g.
                <code>fn:</code>) to restrict the search to a given type.
            </p>
            <p>
                Accepted types are: <code>fn</code>, <code>mod</code>,
                <code>struct</code> (or <code>str</code>), <code>enum</code>,
                <code>trait</code>, <code>typedef</code> (or
                <code>tdef</code>).
            </p>
        </div>
    </div>

    <script>
        window.rootPath = "../";
        window.currentCrate = "probe";
        window.playgroundUrl = "";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    
    <script async src="../search-index.js"></script>
</body>
</html>